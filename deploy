src_dir="$(pwd)/slack-mbta"
src_dir="${src_dir//\//\\/}"
cert_dir="$(pwd)/cert"

echo "Editing slack-mbta.sh.ins to export working directory as MBTA_SLACK_HOME on launch"
sed "s/MBTA_SLACK_HOME/$src_dir/g" slack-mbta.ins > slack-mbta.sh
echo "Moving start and stop script to /etc/init.d/slack-mbta.sh"
sudo mv slack-mbta.sh /etc/init.d/slack-mbta
echo "Enabling /etc/init.d/slack-mbta for execution"
chmod +x /etc/init.d/slack-mbta

echo "Generating SSL certificate. About to ask you some questions..."
echo "You need openssl for this to work"
openssl genrsa -des3 -out server.key 1024
openssl req -new -key server.key -out server.csr
cp server.key server.key.org
openssl rsa -in server.key.org -out server.key
openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt
mkdir -p $cert_dir
mv server.crt $cert_dir
mv server.key $cert_dir
mv server.csr $cert_dir
rm server.key.org
